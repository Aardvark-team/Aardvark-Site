import{Terminal}from"@xterm/xterm";import{FitAddon}from"@xterm/xterm-addon-fit";import{AttachAddon}from"@xterm/xterm-addon-attach";let currentProgram=null,InitialConnectedToAPI=!1,API_endpoint="adk-api.replit.app";function reconnectToExecApi(isManual){window.AARDVARK_API_WEBSOCKET&&1===window.AARDVARK_API_WEBSOCKET.readyState&&window.AARDVARK_API_WEBSOCKET.close(),window.AARDVARK_API_WEBSOCKET=new WebSocket(`wss://${API_endpoint}`),window.AARDVARK_API_WEBSOCKET.addEventListener("message",(ev=>{const data=JSON.parse(ev.data);"string"==typeof data.output&&term.write(data.output),"number"==typeof data.state&&(2===data.state?currentProgram="adk":"adk"===currentProgram&&(currentProgram=null),0===data.state&&(InitialConnectedToAPI&&clearLine(!1),InitialConnectedToAPI=!0))})),window.AARDVARK_API_WEBSOCKET.addEventListener("open",(()=>{isManual&&window.alert("Connected to the code execution api.")})),window.AARDVARK_API_WEBSOCKET.addEventListener("close",(()=>{window.alert("Lost connection to the code execution api. (or didn't even connect)")}))}function checkCodeExecLocalStatus(){const status=window.AARDVARK_API_WEBSOCKET&&1===window.AARDVARK_API_WEBSOCKET.readyState;window.alert(`You are${status?"":" not"} connected to the api.`)}window.addEventListener("load",(()=>{reconnectToExecApi(!0);const terminal=new Terminal({fontFamily:"Monospace",theme:{background:"#1d1d1d"},fontSize:14,cursorBlink:!0}),termEl=document.getElementById("terminal");terminal.open(termEl);const attachAddon=new AttachAddon(window.AARDVARK_API_WEBSOCKET);terminal.loadAddon(attachAddon)}));