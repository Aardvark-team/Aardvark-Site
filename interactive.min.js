import"xterm/css/xterm.css";import{Terminal}from"xterm";import{FitAddon}from"xterm-addon-fit";import{AttachAddon}from"xterm-addon-attach";let currentProgram=null,InitialConnectedToAPI=!1,API_endpoint="adk-api.replit.app";function reconnectToExecApi(isManual){window.AARDVARK_API_WEBSOCKET&&1===window.AARDVARK_API_WEBSOCKET.readyState&&window.AARDVARK_API_WEBSOCKET.close(),window.AARDVARK_API_WEBSOCKET=new WebSocket(`wss://${API_endpoint}`),window.AARDVARK_API_WEBSOCKET.addEventListener("message",(ev=>{const data=JSON.parse(ev.data);"string"==typeof data.output&&terminal.write(data.output),"number"==typeof data.state&&(2===data.state?currentProgram="adk":"adk"===currentProgram&&(currentProgram=null),0===data.state&&(InitialConnectedToAPI&&clearLine(!1),InitialConnectedToAPI=!0))})),window.AARDVARK_API_WEBSOCKET.addEventListener("open",(()=>{isManual&&terminal.write("Connected to the code execution api.\r\n")})),window.AARDVARK_API_WEBSOCKET.addEventListener("close",(()=>{window.alert("Lost connection to the code execution api. (or didn't even connect)")}))}function checkCodeExecLocalStatus(){const status=window.AARDVARK_API_WEBSOCKET&&1===window.AARDVARK_API_WEBSOCKET.readyState;window.alert(`You are${status?"":" not"} connected to the api.`)}class CodeBlock{constructor(code){this.code=code}}var terminal;window.addEventListener("load",(()=>{reconnectToExecApi(!0),terminal=new Terminal({fontFamily:"Monospace",theme:{background:"#1d1d1d"},fontSize:14,cursorBlink:!0,cursorStyle:"bar",cursorInactiveStyle:"none",cursorWidth:2});const termEl=document.getElementById("terminal"),fit=new FitAddon;terminal.loadAddon(fit),terminal.open(termEl),fit.fit();let modifiers={shift:!1,ctrl:!1,alt:!1,meta:!1};const isMac=navigator.userAgent.includes("Mac");terminal.onData((data=>{let code=data.charCodeAt();return"adk"===currentProgram?AARDVARK_API_WEBSOCKET.send(JSON.stringify({input:data})):"\r"===data||"\n"===data?terminal.write("\r\n"):127===code&(isMac&modifiers.meta|!isMac&modifiers.ctrl)?terminal.write("[2K\r"):127===code?terminal.write("\b \b"):("e"===data&&(console.log("DOING IT"),window.AARDVARK_API_WEBSOCKET.send(JSON.stringify({runProgram:{files:{"main.adk":"let x = 5"},args:[],silenced:!1}}))),void terminal.write(data))})),window.addEventListener("keydown",(e=>{"Shift"===e.key&&(modifiers.shift=!0),"Control"===e.key&&(modifiers.ctrl=!0),"Alt"===e.key&&(modifiers.alt=!0),"Meta"===e.key&&(modifiers.meta=!0)}));let keyup=e=>{"Shift"===e.key&&(modifiers.shift=!1),"Control"===e.key&&(modifiers.ctrl=!1),"Alt"===e.key&&(modifiers.alt=!1),"Meta"===e.key&&(modifiers.meta=!1)};window.addEventListener("keyup",keyup),window.addEventListener("blur",keyup),currentProgram="adk"}));